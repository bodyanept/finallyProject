{% extends 'base.html' %}
{% block title %}Корзина — ZapChasti{% endblock %}
{% block content %}
  <h1 class="text-2xl font-semibold mb-6">Корзина</h1>

  {% if items %}
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="md:col-span-2 space-y-4">
      {% for it in items %}
      <div class="flex gap-4 rounded-xl border bg-white p-3">
        <div class="w-28 h-20 bg-slate-100 rounded-md overflow-hidden">
          {% if it.product.images and it.product.images.0 %}
            <img src="{{ it.product.images.0 }}" alt="{{ it.product.name }}" class="w-full h-full object-cover">
          {% endif %}
        </div>
        <div class="flex-1">
          <a href="/parts/{{ it.product.slug }}/" class="font-medium hover:underline">{{ it.product.name }}</a>
          <div class="text-xs text-slate-500">Артикул: {{ it.product.sku }}</div>
          <div class="mt-2 flex items-center gap-3">
            <form method="post" action="/cart/set/{{ it.id }}/" class="flex items-center gap-2">
              {% csrf_token %}
              <input type="number" name="quantity" value="{{ it.quantity }}" min="1" class="w-16 rounded-md border px-2 py-1" />
              <button class="text-sm px-3 py-1.5 rounded-md bg-slate-200 hover:bg-slate-300">Ок</button>
            </form>
            <form method="post" action="/cart/remove/{{ it.id }}/">
              {% csrf_token %}
              <button class="text-sm px-3 py-1.5 rounded-md bg-rose-500 text-white hover:bg-rose-600">Удалить</button>
            </form>
          </div>
        </div>
        <div class="text-right">
          <div class="text-lg font-semibold text-brand-600">{{ it.price_at_add }} ₽</div>
          <div class="text-xs text-slate-500">x {{ it.quantity }}</div>
          <div class="mt-1 text-sm">Итого: {{ it.subtotal }} ₽</div>
        </div>
      </div>
      {% endfor %}
    </div>

    <aside class="space-y-3">
      <div class="rounded-xl border bg-white p-4">
        <div class="flex items-center justify-between">
          <div class="text-slate-600">Сумма</div>
          <div class="font-semibold">{{ cart.total }} ₽</div>
        </div>
        <form method="get" action="/checkout/" class="mt-4">
          <button class="w-full px-4 py-2 rounded-md bg-brand-600 text-white hover:bg-brand-700">Оформить заказ</button>
        </form>
      </div>
      <a href="/catalog/" class="text-sm text-brand-600 hover:underline">Продолжить покупки</a>
    </aside>
  </div>
  {% else %}
    <div class="rounded-xl border bg-white p-8 text-center text-slate-600">
      Корзина пуста. <a href="/catalog/" class="text-brand-600 hover:underline">Перейти в каталог</a>
    </div>
  {% endif %}
{% endblock %}
